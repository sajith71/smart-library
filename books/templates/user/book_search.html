{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search Books</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(120deg, #101014 0%, #23263a 100%);
      min-height: 100vh;
      position: relative;
    }
    .animated-bg-gradient {
      width: 100vw;
      height: 100vh;
      background: linear-gradient(120deg, #101014 0%, #23263a 100%);
      opacity: 0.12;
      filter: blur(80px);
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }
    .glass-effect {
      background: rgba(20, 22, 32, 0.96);
      backdrop-filter: blur(18px);
      border: 1.5px solid rgba(60,72,100,0.18);
      box-shadow: 0 8px 32px 0 rgba(35,38,58,0.10);
      border-radius: 1.5rem;
    }
    .cool-btn {
      background: linear-gradient(90deg, #23263a 0%, #3a4256 100%);
      color: #f5f5f5;
      box-shadow: 0 4px 24px 0 rgba(35,38,58,0.12), 0 0 8px 2px #23263a;
      border-radius: 1.25rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      transition: background 0.2s, color 0.2s;
    }
    .cool-btn:hover {
      background: linear-gradient(90deg, #3a4256 0%, #101014 100%);
      color: #ffd700;
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="animated-bg-gradient"></div>
  <div class="relative z-10 flex flex-col min-h-screen justify-center items-center px-2 py-6">
    <div class="w-full max-w-2xl glass-effect p-8 mb-8 mt-8">
      <h1 class="text-3xl font-bold text-white mb-6 text-center">üîç Search Books</h1>

      <!-- üé§ Search Form -->
      <form method="GET" class="flex flex-col md:flex-row gap-4 items-center justify-center mb-4">
        <input
          type="text"
          id="search-input"
          name="q"
          placeholder="Type here..."
          value="{{ query|default_if_none:'' }}"
          class="flex-1 px-4 py-3 rounded-lg bg-gray-900 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-700"
        />
        <button type="submit" class="cool-btn px-6 py-3">Search</button>
        <button type="button" id="voiceSearchBtn" class="cool-btn px-4 py-2">üéô Voice Search</button>
      </form>

      <!-- üîÅ JS for Offline Voice Search -->
      <script>
        document.getElementById("voiceSearchBtn").addEventListener("click", () => {
          fetch("/voice-search/")
            .then(response => response.json())
            .then(data => {
              const query = data.query;
              if (query) {
                document.querySelector("input[name='q']").value = query;
                document.querySelector("form").submit();
              } else {
                alert("Sorry, no voice input detected.");
              }
            })
            .catch(error => {
              alert("Voice recognition failed.");
              console.error(error);
            });
        });
      </script>

      {% if recommendations %}
            <div class="mb-8">
                <h2 class="text-xl font-bold text-cyan-300 mb-4 text-center flex items-center justify-center gap-2">
                    <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m4 0h-1v-4h-1m-4 0h-1v-4h-1"/></svg>
                    Personalized Recommendations
                </h2>
                <div class="space-y-4">
                    {% for book in recommendations %}
                    <div class="book-card border-cyan-700/40">
                        <div class="flex flex-col gap-2 mb-2">
                            <h3 class="text-lg font-bold text-cyan-200 flex items-center gap-2">
                                {{ book.title }}
                                {% if book.location %}
                                <span class="inline-flex items-center bg-gradient-to-r from-cyan-400 to-cyan-600 text-gray-900 font-semibold px-3 py-1 rounded-full text-xs ml-2 shadow border border-cyan-900">
                                    <svg class="w-4 h-4 mr-1 text-cyan-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a2 2 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                    Block <b>{{ book.location.block }}</b>, Row <b>{{ book.location.row }}</b>, Col <b>{{ book.location.column }}</b>, Pos <b>{{ book.location.position }}</b>
                                </span>
                                {% endif %}
                            </h3>
                            <div class="flex flex-wrap gap-3 text-sm text-gray-400 mb-1">
                                <span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"/></svg>by {{ book.author }}</span>
                                {% if book.publication_year %}<span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>{{ book.publication_year }}</span>{% endif %}
                                {% if book.available_copies is not None %}<span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v4a1 1 0 001 1h3m10-5v4a1 1 0 01-1 1h-3m-4 4h4m-2 0v4m0 0h-2a2 2 0 01-2-2v-2a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2z"/></svg>Available: {{ book.available_copies }}</span>{% endif %}
                            </div>
                        </div>
                        <p class="text-gray-300 mt-2 leading-relaxed text-sm">{{ book.summary|truncatewords:25 }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if query %}
                <h3 class="text-lg text-gray-200 mb-4 text-center">Results for "<span class="text-yellow-300">{{ query }}</span>":</h3>
                {% if results %}
                    <div class="space-y-6">
                        {% for book in results %}
                        <div class="book-card transition-transform duration-200 hover:scale-[1.025] hover:shadow-2xl">
                            <div class="flex flex-col gap-2 mb-2">
                                <h2 class="text-2xl font-bold text-yellow-200 mb-1 flex items-center gap-2">
                                    {{ book.title }}
                                    {% if book.location %}
                                    <span class="inline-flex items-center bg-gradient-to-r from-yellow-400 to-yellow-600 text-gray-900 font-semibold px-4 py-1 rounded-full text-xs ml-2 shadow border border-yellow-900">
                                        <svg class="w-4 h-4 mr-1 text-yellow-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a2 2 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                        Block <b>{{ book.location.block }}</b>, Row <b>{{ book.location.row }}</b>, Col <b>{{ book.location.column }}</b>, Pos <b>{{ book.location.position }}</b>
                                    </span>
                                    {% endif %}
                                </h2>
                                <div class="flex flex-wrap gap-3 text-sm text-gray-400 mb-1">
                                    <span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"/></svg>by {{ book.author }}</span>
                                    {% if book.publication_year %}<span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>{{ book.publication_year }}</span>{% endif %}
                                    {% if book.available_copies is not None %}<span class="inline-flex items-center"><svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v4a1 1 0 001 1h3m10-5v4a1 1 0 01-1 1h-3m-4 4h4m-2 0v4m0 0h-2a2 2 0 01-2-2v-2a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2z"/></svg>Available: {{ book.available_copies }}</span>{% endif %}
                                </div>
                            </div>
                            <p class="text-gray-300 mt-3 leading-relaxed">{{ book.summary|truncatewords:30 }}</p>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-center text-gray-400">No books found matching your query.</p>
                {% endif %}
            {% endif %}
      {% comment %} (Keep your book card rendering logic here, untouched) {% endcomment %}
      {{ block.super }}

      <!-- Back to Dashboard Button -->
      <div class="mt-10 flex justify-center">
        <a href="{% url 'user_dashboard' %}"
           class="cool-btn px-8 py-3 text-base font-semibold rounded-xl bg-gradient-to-r from-indigo-500 to-cyan-400 hover:from-indigo-600 hover:to-cyan-500 transition-all duration-300 text-white shadow-md hover:shadow-lg flex items-center gap-2">
          ‚Üê Back to Dashboard
        </a>
      </div>
    </div>
  </div>

  <!-- Footer -->
<footer class="bg-gray-800 text-white py-8 mt-10">
    <div class="max-w-5xl mx-auto px-4">
        <div class="text-center">
            <p class="text-sm text-gray-400">Designed with <span class="text-pink-400 animate-pulse inline-block">&#10084;</span> for library lovers</p>
        </div>
    </div>
</footer>
</body>
</html>
