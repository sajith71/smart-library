{% load static %}
{% block content %}

<!-- Header & Back Button -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
  <div style="flex: 1; text-align: center;">
    <h2 style="margin-bottom: 10px; display: inline-block;">üìã Visitor List & Insights</h2>
  </div>
  <a href="{% url 'admin_dashboard' %}" style="background: linear-gradient(to right, #3b82f6, #764ba2); color: white; font-weight: 600; font-size: 1.1rem; padding: 12px 36px; border-radius: 12px; box-shadow: 0 4px 16px rgba(59,130,246,0.10); text-decoration: none; transition: background 0.3s;"
     onmouseover="this.style.background='linear-gradient(to right, #2563eb, #6d28d9)'" 
     onmouseout="this.style.background='linear-gradient(to right, #3b82f6, #764ba2)'">
    ‚Üê Back to Dashboard
  </a>
</div>

<!-- Charts -->
<div style="display: flex; flex-wrap: wrap; gap: 30px; margin: 30px 0;">
  <div style="flex: 1; min-width: 300px;">
    <canvas id="roleChart" height="180"></canvas>
  </div>
  <div style="flex: 2; min-width: 300px;">
    <canvas id="monthlyChart" height="180"></canvas>
  </div>
</div>

<hr style="margin: 30px 0;">

<!-- üìå Fake Users -->
<h3>üö® Suspected Fake Users</h3>
<table border="1" style="width: 100%; background-color: #ffeeee;">
  <thead>
    <tr>
      <th>Name</th>
      <th>Age</th>
      <th>Score</th>
      <th>Visit Count</th>
    </tr>
  </thead>
  <tbody>
    {% for user in fake_users %}
    <tr>
      <td>{{ user.name }}</td>
      <td>{{ user.age }}</td>
      <td>{{ user.score }}</td>
      <td>{{ user.visit_count }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<hr style="margin: 30px 0;">

<!-- üë• All Visitors -->
<h3>üë• All Visitors</h3>
<table border="1" style="border-collapse: collapse; width: 100%; margin-top: 10px;">
  <thead>
    <tr style="background-color: #f0f0f0;">
      <th style="padding: 8px;">Name</th>
      <th style="padding: 8px;">Mobile</th>
      <th style="padding: 8px;">Role</th>
      <th style="padding: 8px;">Registered</th>
    </tr>
  </thead>
  <tbody>
    {% for v in visitors %}
      <tr>
        <td style="padding: 6px;">{{ v.name }}</td>
        <td style="padding: 6px;">{{ v.mobile }}</td>
        <td style="padding: 6px;">{{ v.role }}</td>
        <td style="padding: 6px;">{{ v.created_at|date:"Y-m-d" }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const roleCtx = document.getElementById('roleChart').getContext('2d');
  new Chart(roleCtx, {
    type: 'bar',
    data: {
      labels: ['Users', 'Admins'],
      datasets: [{
        label: 'Visitor Role Count',
        data: [{{ user_count }}, {{ admin_count }}],
        backgroundColor: ['#3498db', '#e67e22'],
        borderRadius: 5
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'Visitor Roles',
          font: { size: 16 }
        },
        legend: { display: false }
      },
      responsive: true,
      maintainAspectRatio: false
    }
  });

  const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
  new Chart(monthlyCtx, {
    type: 'line',
    data: {
      labels: [{% for m in months %}'{{ m }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
      datasets: [{
        label: 'Registrations per Month',
        data: [{% for c in monthly_counts %}{{ c }}{% if not forloop.last %}, {% endif %}{% endfor %}],
        backgroundColor: '#2ecc71',
        borderColor: '#27ae60',
        borderWidth: 2,
        tension: 0.4,
        fill: false
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'Monthly Visitor Registrations',
          font: { size: 16 }
        }
      },
      responsive: true,
      maintainAspectRatio: false
    }
  });
</script>

{% endblock %}
