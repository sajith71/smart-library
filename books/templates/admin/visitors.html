
{% load static %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Inter', sans-serif; }
  .glass-effect {
    background: rgba(30, 41, 59, 0.7);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(59, 130, 246, 0.18);
  }
  .gradient-bg {
    background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
  }
  .cool-btn {
    background: linear-gradient(90deg, #38bdf8 0%, #818cf8 100%);
    color: #fff;
    box-shadow: 0 4px 24px 0 rgba(56,189,248,0.15);
    transition: all 0.3s cubic-bezier(.4,0,.2,1);
  }
  .cool-btn:hover {
    background: linear-gradient(90deg, #0ea5e9 0%, #6366f1 100%);
    transform: scale(1.04);
    box-shadow: 0 8px 32px 0 rgba(56,189,248,0.25);
  }
  .dark-table {
    background: rgba(30,41,59,0.85);
    color: #e0e7ef;
    border-radius: 1rem;
    overflow: hidden;
  }
  .dark-table th {
    background: linear-gradient(90deg, #1e293b 60%, #334155 100%);
    color: #38bdf8;
    font-weight: 600;
    padding: 12px 8px;
  }
  .dark-table td {
    background: rgba(30,41,59,0.7);
    color: #e0e7ef;
    padding: 10px 8px;
  }
  .dark-table tr {
    border-bottom: 1px solid #334155;
    transition: background 0.2s;
  }
  .dark-table tr:hover {
    background: rgba(56,189,248,0.08);
  }
</style>
<div class="min-h-screen gradient-bg py-10 px-4">
  <div class="max-w-5xl mx-auto glass-effect rounded-3xl shadow-2xl p-8">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold text-white flex items-center gap-2 animate-fade-in">üìã Visitor List & Insights</h2>
      <a href="{% url 'admin_dashboard' %}" class="cool-btn font-semibold px-8 py-3 rounded-xl shadow-lg text-lg">‚Üê Back to Dashboard</a>
    </div>
    <div class="flex flex-wrap gap-8 mb-10">
      <div class="flex-1 min-w-[300px] glass-effect rounded-2xl p-6 shadow-xl">
        <canvas id="roleChart" height="180"></canvas>
      </div>
      <div class="flex-1 min-w-[300px] glass-effect rounded-2xl p-6 shadow-xl">
        <canvas id="monthlyChart" height="180"></canvas>
      </div>
    </div>
    <h3 class="text-xl font-bold text-cyan-300 mb-4">üë• All Visitors</h3>
    <div class="overflow-x-auto">
      <table class="w-full dark-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Mobile</th>
            <th>Role</th>
            <th>Registered</th>
          </tr>
        </thead>
        <tbody>
          {% for v in visitors %}
          <tr>
            <td>{{ v.name }}</td>
            <td>{{ v.mobile }}</td>
            <td>{{ v.role }}</td>
            <td>{{ v.created_at|date:"Y-m-d" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Spam Visitors Section -->
    <h3 class="text-xl font-bold text-pink-400 mt-12 mb-4">üö´ Spam Visitors</h3>
    <div class="overflow-x-auto">
      <table class="w-full dark-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Mobile</th>
            <th>Role</th>
            <th>Registered</th>
          </tr>
        </thead>
        <tbody>
          {% for v in spam_visitors %}
          <tr class="bg-pink-950/60">
            <td>{{ v.name }}</td>
            <td>{{ v.mobile }}</td>
            <td>{{ v.role }}</td>
            <td>{{ v.created_at|date:"Y-m-d" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="text-center text-pink-300 py-4">No spam visitors found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const roleCtx = document.getElementById('roleChart').getContext('2d');
  new Chart(roleCtx, {
    type: 'bar',
    data: {
      labels: ['Users', 'Admins'],
      datasets: [{
        label: 'Visitor Role Count',
        data: [{{ user_count }}, {{ admin_count }}],
        backgroundColor: ['#38bdf8', '#818cf8'],
        borderRadius: 8
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'Visitor Roles',
          color: '#e0e7ef',
          font: { size: 16 }
        },
        legend: { display: false }
      },
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { ticks: { color: '#e0e7ef' }, grid: { color: '#334155' } },
        y: { ticks: { color: '#e0e7ef' }, grid: { color: '#334155' } }
      }
    }
  });
  const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
  new Chart(monthlyCtx, {
    type: 'line',
    data: {
      labels: [{% for m in monthly_labels %}'{{ m }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
      datasets: [{
        label: 'Registrations per Month',
        data: [{% for c in monthly_counts %}{{ c }}{% if not forloop.last %}, {% endif %}{% endfor %}],
        backgroundColor: 'rgba(56,189,248,0.2)',
        borderColor: '#38bdf8',
        borderWidth: 2,
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'Monthly Visitor Registrations',
          color: '#e0e7ef',
          font: { size: 16 }
        }
      },
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { ticks: { color: '#e0e7ef' }, grid: { color: '#334155' } },
        y: { ticks: { color: '#e0e7ef' }, grid: { color: '#334155' } }
      }
    }
  });
</script>
{% endblock %}
